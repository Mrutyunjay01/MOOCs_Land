%% Given Signals
Am1= 1;
Am2= 1;
fm1 = 50;
fm2 = 50;
fc = 1000;
fc1 = 500;
N = 1e4;
t = 100*(-1/fm1):1/N:100*1/fm1;
x1 = Am1 * sinc(pi*fm1*t);
x2 = Am2 * (sinc(pi*fm2*t)).^2;
ct = cos(2*pi*fc*t);
ct1 = cos(2*pi*fc1*t);

%% Mutliplexing
x = x1 + (1+x2).*ct1;
st = x.*ct;
figure;
subplot(2,2,1);
plot(t(18000:22000),x1(18000:22000));
title("Message Signal 1");
subplot(2,2,2);
plot(t(18000:22000),x2(18000:22000));

title("Message Signal 2");
subplot(2,2,3);
plot(t(18000:22000),x(18000:22000));
title("Multiplexed signal x");
subplot(2,2,4);
plot(t(18000:22000),st(18000:22000));
title("Final AM signal")

%% PSD of Message signals and Mux Signals
fs = N;
px1t = pwelch(x1,500,300,32768,fs,'centered','power');
ff = [-fs/2:fs/length(px1t):fs/2 - fs/length(px1t)];
px2t = pwelch(x2,500,300,32768,fs,'centered','power');
pxt = pwelch(x,500,300,32768,fs,'centered','power');
pst = pwelch(st,500,300,32768,fs,'centered','power');
figure;
subplot(2,2,1);
plot(ff,px1t);
title("Message signal 1");
subplot(2,2,2);
plot(ff,px2t);
title("Message signal 2");
subplot(2,2,3);
plot(ff,pxt);
title("Multiplexed signal x(t)");
subplot(2,2,4);
plot(ff,pst);
title("Final AM signal");

%% Demuxing
bpf_num = [-2.76958301397807e-05,8.67381322662034e-05,0.000167864048430882,0.000298856937454913,0.000464940132218577,0.000647220871821795,0.000817260312180122,0.000938139037761346,0.000968821216488393,0.000870952916706888,0.000616916178942073,0.000197924228515589,-0.000369585436046113,-0.00104072453422235,-0.00174358627870902,-0.00238583975630875,-0.00286634006943575,-0.00309019878273774,-0.00298533278645580,-0.00251754701433628,-0.00170136508020580,-0.000603764887559648,0.000660495752666116,0.00194222776212489,0.00307818879015341,0.00391603900909357,0.00433938681255081,0.00428855721731489,0.00377284692681349,0.00287226702204490,0.00172582168208147,0.000510043260386370,-0.000591003535825833,-0.00141794995002464,-0.00186500733944270,-0.00190004899630537,-0.00157127276116172,-0.000998871361114179,-0.000352342311166999,0.000182632337106688,0.000441854614718981,0.000317436510144112,-0.000217171231795240,-0.00109748998938388,-0.00217633624122115,-0.00324942010821099,-0.00409386024020620,-0.00451246313514215,-0.00437508187861504,-0.00364851320534349,-0.00240822979249484,-0.000828670643165989,0.000846891124615857,0.00235183490852668,0.00344840984194841,0.00397622548833664,0.00388678094036697,0.00325653412600663,0.00227426093002839,0.00120463692411980,0.000334091282120349,-9.04809285310208e-05,8.24339119169549e-05,0.000870343637403297,0.00214465547876031,0.00364888141769051,0.00504515562918350,0.00598075690071293,0.00616193821368712,0.00541991350939204,0.00375482727028789,0.00134723543891768,-0.00146707180903757,-0.00425574722645223,-0.00657166560756757,-0.00804204950969958,-0.00844674238597675,-0.00776879330616019,-0.00620526404254520,-0.00413385068620689,-0.00203994043012541,-0.000417209095179187,0.000338876024531106,2.26423545698306e-05,-0.00132532680237545,-0.00341068538230917,-0.00573159657913687,-0.00767224147125601,-0.00862709198855809,-0.00813197182081539,-0.00597483928087217,-0.00226208512724961,0.00257657660060692,0.00784962487799198,0.0127235161091933,0.0163798884751126,0.0181804494781179,0.0178061462502564,0.0153403438082836,0.0112750479088702,0.00643350398408840,0.00181897945350390,-0.00158483032446588,-0.00302480358460504,-0.00215882132758826,0.000833215833873233,0.00523574364019602,0.00989208994421774,0.0133976419209343,0.0143621774353914,0.0116964168271315,0.00486997145885898,-0.00591064584918260,-0.0196437296292699,-0.0346144426639285,-0.0486132275067077,-0.0592617382949555,-0.0643964766159366,-0.0624469695575179,-0.0527432114240534,-0.0356958820911135,-0.0128124202724819,0.0134615521546000,0.0400566344738485,0.0637042899884472,0.0814064138948364,0.0908756294506103,0.0908756294506103,0.0814064138948364,0.0637042899884472,0.0400566344738485,0.0134615521546000,-0.0128124202724819,-0.0356958820911135,-0.0527432114240534,-0.0624469695575179,-0.0643964766159366,-0.0592617382949555,-0.0486132275067077,-0.0346144426639285,-0.0196437296292699,-0.00591064584918260,0.00486997145885898,0.0116964168271315,0.0143621774353914,0.0133976419209343,0.00989208994421774,0.00523574364019602,0.000833215833873233,-0.00215882132758826,-0.00302480358460504,-0.00158483032446588,0.00181897945350390,0.00643350398408840,0.0112750479088702,0.0153403438082836,0.0178061462502564,0.0181804494781179,0.0163798884751126,0.0127235161091933,0.00784962487799198,0.00257657660060692,-0.00226208512724961,-0.00597483928087217,-0.00813197182081539,-0.00862709198855809,-0.00767224147125601,-0.00573159657913687,-0.00341068538230917,-0.00132532680237545,2.26423545698306e-05,0.000338876024531106,-0.000417209095179187,-0.00203994043012541,-0.00413385068620689,-0.00620526404254520,-0.00776879330616019,-0.00844674238597675,-0.00804204950969958,-0.00657166560756757,-0.00425574722645223,-0.00146707180903757,0.00134723543891768,0.00375482727028789,0.00541991350939204,0.00616193821368712,0.00598075690071293,0.00504515562918350,0.00364888141769051,0.00214465547876031,0.000870343637403297,8.24339119169549e-05,-9.04809285310208e-05,0.000334091282120349,0.00120463692411980,0.00227426093002839,0.00325653412600663,0.00388678094036697,0.00397622548833664,0.00344840984194841,0.00235183490852668,0.000846891124615857,-0.000828670643165989,-0.00240822979249484,-0.00364851320534349,-0.00437508187861504,-0.00451246313514215,-0.00409386024020620,-0.00324942010821099,-0.00217633624122115,-0.00109748998938388,-0.000217171231795240,0.000317436510144112,0.000441854614718981,0.000182632337106688,-0.000352342311166999,-0.000998871361114179,-0.00157127276116172,-0.00190004899630537,-0.00186500733944270,-0.00141794995002464,-0.000591003535825833,0.000510043260386370,0.00172582168208147,0.00287226702204490,0.00377284692681349,0.00428855721731489,0.00433938681255081,0.00391603900909357,0.00307818879015341,0.00194222776212489,0.000660495752666116,-0.000603764887559648,-0.00170136508020580,-0.00251754701433628,-0.00298533278645580,-0.00309019878273774,-0.00286634006943575,-0.00238583975630875,-0.00174358627870902,-0.00104072453422235,-0.000369585436046113,0.000197924228515589,0.000616916178942073,0.000870952916706888,0.000968821216488393,0.000938139037761346,0.000817260312180122,0.000647220871821795,0.000464940132218577,0.000298856937454913,0.000167864048430882,8.67381322662034e-05,-2.76958301397807e-05];
lpf_num = [-3.32634838873686e-05,-7.68443865098860e-06,-8.42424712673225e-06,-9.10541137924542e-06,-9.70462684826739e-06,-1.02075231053484e-05,-1.05896653759440e-05,-1.08360243669646e-05,-1.09217535908140e-05,-1.08316715165297e-05,-1.05411364902800e-05,-1.00364522079551e-05,-9.29546249677240e-06,-8.30811315862275e-06,-7.05751807533683e-06,-5.53970685319315e-06,-3.74435565048779e-06,-1.67568865648839e-06,6.69940507979263e-07,3.28102728333540e-06,6.15464698163134e-06,9.27153839603821e-06,1.26203819382064e-05,1.61707621750997e-05,1.99003819985693e-05,2.37653164837984e-05,2.77322745324777e-05,3.17481681578611e-05,3.57751687141937e-05,3.97548628122063e-05,4.36445170529709e-05,4.73705451009784e-05,5.08761133849731e-05,5.40736886728033e-05,5.69197729026047e-05,5.93424965757034e-05,6.13084506983750e-05,6.26578769171857e-05,6.34106183915098e-05,6.34879050114959e-05,6.27960008954123e-05,6.13264873651867e-05,5.89980637582505e-05,5.57941172320222e-05,5.16638849712071e-05,4.65975778421318e-05,4.05684938898205e-05,3.35833355399045e-05,2.56410658747382e-05,1.67701726993520e-05,6.99696798366480e-06,-3.62594592765856e-06,-1.50450394866356e-05,-2.71812630370979e-05,-3.99533540680723e-05,-5.32551021158684e-05,-6.69768290386976e-05,-8.09863836151198e-05,-9.51485891624602e-05,-0.000109309557800076,-0.000123313993716432,-0.000136989054818040,-0.000150160970413238,-0.000162642092741298,-0.000174247918973005,-0.000184787380493232,-0.000194077197599002,-0.000201927465984707,-0.000208156699235211,-0.000212582771612242,-0.000215045309398345,-0.000215390208441535,-0.000213479027450339,-0.000209173672232124,-0.000202383397480434,-0.000193026607726614,-0.000181025136890468,-0.000166365798954462,-0.000149025316911687,-0.000129034591164693,-0.000106441680037934,-8.13332795415014e-05,-5.38244036414931e-05,-2.40654690299618e-05,7.76176712617175e-06,4.14412862707032e-05,7.67251703834777e-05,0.000113333532786593,0.000150956620948464,0.000189255658754819,0.000227867402053770,0.000266404034306337,0.000304457991385940,0.000341603473029403,0.000377400672189570,0.000411401118979185,0.000443151668433656,0.000472199075913171,0.000498093881659674,0.000520395633323506,0.000538677457858369,0.000552534742241678,0.000561588220872558,0.000565488854455582,0.000563921480977526,0.000556613095945469,0.000543338315547940,0.000523923549766785,0.000498245047753853,0.000466239420632339,0.000427909966719540,0.000383325660659347,0.000332611172405912,0.000275981995461002,0.000213705314185767,0.000146130244446260,7.36755449123157e-05,-3.17253619042467e-06,-8.38547823092596e-05,-0.000167749930516215,-0.000254170617231865,-0.000342373990690524,-0.000431561343842334,-0.000520888359502269,-0.000609467232425389,-0.000696376915832970,-0.000780669776893694,-0.000861381162404329,-0.000937537226417181,-0.00100816588763430,-0.00107230333314733,-0.00112900904162068,-0.00117737211358616,-0.00121652560661175,-0.00124565357961019,-0.00126400403183996,-0.00127089635046896,-0.00126573637082008,-0.00124802152073023,-0.00121735183531533,-0.00117343574008058,-0.00111610190627963,-0.00104530362250750,-0.000961126372073766,-0.000863787131756867,-0.000753645099239785,-0.000631200822505681,-0.000497097807734638,-0.000352116572546500,-0.000197188045846550,-3.33718626479028e-05,0.000138136687963917,0.000316012282092984,0.000498817007383126,0.000684996384238697,0.000872901023332216,0.00106079008178592,0.00124684998354272,0.00142920576810722,0.00160593840680338,0.00177509983475464,0.00193473041591091,0.00208287831878474,0.00221761714974010,0.00233706620657985,0.00243940993728796,0.00252291566880938,0.00258595672997790,0.00262702899198676,0.00264477195559829,0.00263798620481607,0.00260565032311259,0.00254693825783210,0.00246123628748389,0.00234815579258147,0.00220754502840263,0.00203950126283032,0.00184437988772299,0.00162280220271390,0.00137565938081865,0.00110411497381023,0.000809607436900930,0.000493848149751881,0.000158814878397157,-0.000193253241790714,-0.000559861995120981,-0.000938278436591528,-0.00132554341297826,-0.00171848132967312,-0.00211373144779001,-0.00250775483605679,-0.00289686758286399,-0.00327725861572634,-0.00364501935063419,-0.00399617097300532,-0.00432669359871359,-0.00463255663508666,-0.00490974969911754,-0.00515431543152143,-0.00536238172284308,-0.00553019378185101,-0.00565414833936234,-0.00573082172431995,-0.00575700678864101,-0.00572973866074266,-0.00564632737980698,-0.00550438430500232,-0.00530184715814965,-0.00503700536441140,-0.00470852308640987,-0.00431545666199683,-0.00385727184533256,-0.00333385842327362,-0.00274554115905526,-0.00209308727518446,-0.00137771137758252,-0.000601075887430994,0.000234709303949053,0.00112709344763349,0.00207309459051300,0.00306931072472449,0.00411193517390323,0.00519677788063909,0.00631928638551507,0.00747456765755651,0.00865742382388588,0.00986237559698191,0.0110836995194350,0.0123154632782683,0.0135515603730892,0.0147857542454714,0.0160117141174500,0.0172230603597029,0.0184134039952878,0.0195763923674103,0.0207057508272235,0.0217953263196850,0.0228391303389610,0.0238313779168256,0.0247665315274417,0.0256393376843239,0.0264448640247012,0.0271785370983491,0.0278361688594600,0.0284139928402182,0.0289086876161209,0.0293174016083657,0.0296377719456852,0.0298679446557318,0.0300065846000551,0.0300528876443266,0.0300065846000551,0.0298679446557318,0.0296377719456852,0.0293174016083657,0.0289086876161209,0.0284139928402182,0.0278361688594600,0.0271785370983491,0.0264448640247012,0.0256393376843239,0.0247665315274417,0.0238313779168256,0.0228391303389610,0.0217953263196850,0.0207057508272235,0.0195763923674103,0.0184134039952878,0.0172230603597029,0.0160117141174500,0.0147857542454714,0.0135515603730892,0.0123154632782683,0.0110836995194350,0.00986237559698191,0.00865742382388588,0.00747456765755651,0.00631928638551507,0.00519677788063909,0.00411193517390323,0.00306931072472449,0.00207309459051300,0.00112709344763349,0.000234709303949053,-0.000601075887430994,-0.00137771137758252,-0.00209308727518446,-0.00274554115905526,-0.00333385842327362,-0.00385727184533256,-0.00431545666199683,-0.00470852308640987,-0.00503700536441140,-0.00530184715814965,-0.00550438430500232,-0.00564632737980698,-0.00572973866074266,-0.00575700678864101,-0.00573082172431995,-0.00565414833936234,-0.00553019378185101,-0.00536238172284308,-0.00515431543152143,-0.00490974969911754,-0.00463255663508666,-0.00432669359871359,-0.00399617097300532,-0.00364501935063419,-0.00327725861572634,-0.00289686758286399,-0.00250775483605679,-0.00211373144779001,-0.00171848132967312,-0.00132554341297826,-0.000938278436591528,-0.000559861995120981,-0.000193253241790714,0.000158814878397157,0.000493848149751881,0.000809607436900930,0.00110411497381023,0.00137565938081865,0.00162280220271390,0.00184437988772299,0.00203950126283032,0.00220754502840263,0.00234815579258147,0.00246123628748389,0.00254693825783210,0.00260565032311259,0.00263798620481607,0.00264477195559829,0.00262702899198676,0.00258595672997790,0.00252291566880938,0.00243940993728796,0.00233706620657985,0.00221761714974010,0.00208287831878474,0.00193473041591091,0.00177509983475464,0.00160593840680338,0.00142920576810722,0.00124684998354272,0.00106079008178592,0.000872901023332216,0.000684996384238697,0.000498817007383126,0.000316012282092984,0.000138136687963917,-3.33718626479028e-05,-0.000197188045846550,-0.000352116572546500,-0.000497097807734638,-0.000631200822505681,-0.000753645099239785,-0.000863787131756867,-0.000961126372073766,-0.00104530362250750,-0.00111610190627963,-0.00117343574008058,-0.00121735183531533,-0.00124802152073023,-0.00126573637082008,-0.00127089635046896,-0.00126400403183996,-0.00124565357961019,-0.00121652560661175,-0.00117737211358616,-0.00112900904162068,-0.00107230333314733,-0.00100816588763430,-0.000937537226417181,-0.000861381162404329,-0.000780669776893694,-0.000696376915832970,-0.000609467232425389,-0.000520888359502269,-0.000431561343842334,-0.000342373990690524,-0.000254170617231865,-0.000167749930516215,-8.38547823092596e-05,-3.17253619042467e-06,7.36755449123157e-05,0.000146130244446260,0.000213705314185767,0.000275981995461002,0.000332611172405912,0.000383325660659347,0.000427909966719540,0.000466239420632339,0.000498245047753853,0.000523923549766785,0.000543338315547940,0.000556613095945469,0.000563921480977526,0.000565488854455582,0.000561588220872558,0.000552534742241678,0.000538677457858369,0.000520395633323506,0.000498093881659674,0.000472199075913171,0.000443151668433656,0.000411401118979185,0.000377400672189570,0.000341603473029403,0.000304457991385940,0.000266404034306337,0.000227867402053770,0.000189255658754819,0.000150956620948464,0.000113333532786593,7.67251703834777e-05,4.14412862707032e-05,7.76176712617175e-06,-2.40654690299618e-05,-5.38244036414931e-05,-8.13332795415014e-05,-0.000106441680037934,-0.000129034591164693,-0.000149025316911687,-0.000166365798954462,-0.000181025136890468,-0.000193026607726614,-0.000202383397480434,-0.000209173672232124,-0.000213479027450339,-0.000215390208441535,-0.000215045309398345,-0.000212582771612242,-0.000208156699235211,-0.000201927465984707,-0.000194077197599002,-0.000184787380493232,-0.000174247918973005,-0.000162642092741298,-0.000150160970413238,-0.000136989054818040,-0.000123313993716432,-0.000109309557800076,-9.51485891624602e-05,-8.09863836151198e-05,-6.69768290386976e-05,-5.32551021158684e-05,-3.99533540680723e-05,-2.71812630370979e-05,-1.50450394866356e-05,-3.62594592765856e-06,6.99696798366480e-06,1.67701726993520e-05,2.56410658747382e-05,3.35833355399045e-05,4.05684938898205e-05,4.65975778421318e-05,5.16638849712071e-05,5.57941172320222e-05,5.89980637582505e-05,6.13264873651867e-05,6.27960008954123e-05,6.34879050114959e-05,6.34106183915098e-05,6.26578769171857e-05,6.13084506983750e-05,5.93424965757034e-05,5.69197729026047e-05,5.40736886728033e-05,5.08761133849731e-05,4.73705451009784e-05,4.36445170529709e-05,3.97548628122063e-05,3.57751687141937e-05,3.17481681578611e-05,2.77322745324777e-05,2.37653164837984e-05,1.99003819985693e-05,1.61707621750997e-05,1.26203819382064e-05,9.27153839603821e-06,6.15464698163134e-06,3.28102728333540e-06,6.69940507979263e-07,-1.67568865648839e-06,-3.74435565048779e-06,-5.53970685319315e-06,-7.05751807533683e-06,-8.30811315862275e-06,-9.29546249677240e-06,-1.00364522079551e-05,-1.05411364902800e-05,-1.08316715165297e-05,-1.09217535908140e-05,-1.08360243669646e-05,-1.05896653759440e-05,-1.02075231053484e-05,-9.70462684826739e-06,-9.10541137924542e-06,-8.42424712673225e-06,-7.68443865098860e-06,-3.32634838873686e-05];
y1= st.*ct;
x1 = filter(lpf_num,1,y1);
y2 = filter(bpf_num,1,y1);
x2 = filter(abs(lpf_num),1,abs(y2));
figure;
subplot(2,1,1);
plot(t(18000:22000),x1(18000:22000))
title("DeMux Message signal 1");
subplot(2,1,2);
plot(t(18000:22000),x2(18000:22000));
title("DeMux Message signal 2");